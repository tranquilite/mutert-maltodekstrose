<!DOCTYPE html>
<html>
<head>
    <title>IBE206 Øving 1 - Bridge</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; }
        .handling_c { border: 1px solid gray; border-radius: 10px; background-color: #EEEEEE ; padding: 1em; margin: 1em;}
        .respons_c, .spiller-hand { font-family: monospace; font-size: 8pt; margin: 1em;}
    </style>
    <script lang="text/js">
        // endless shitfuckery
        // "Brought to you by the australien government"
        function start_spill() {
            spillarr = [];
            for (i = 1; i <= 4; i++) {  // smerte
                spillarr.push(document.getElementById("spiller"+i.toString()).value);
            }
        const spiller_post = { "spillere": spillarr };

        fetch("/bridge/start", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(spiller_post) } )
        .then(response => { return response.json(); })
        .then(data => {

            document.getElementById("start_spill_c").innerHTML = 
                `<button id="btn_ss_call" onclick="document.getElementById("start_spill_c").textContent = JSON.stringify(data, null, 2);">Vis svar</button>`;
            document.getElementById("btn_ss_call").addEventListener("click", () => { document.getElementById("start_spill_c").textContent = JSON.stringify(data, null, 2); });
            populer_handtabell(data);
            });
        }

        function populer_handtabell(spillebord) {
            let spha_t = document.getElementById("spiller_hand");
            let tbody = spha_t.getElementsByTagName('tbody')[0];

            // I declare exterminatus
            while (tbody.firstChild) { tbody.removeChild(tbody.firstChild); }

            for (spiller in spillebord) {
                spiller = spillebord[spiller];  // ugly hack

                let neste_rad = tbody.insertRow();
                let c1 = neste_rad.insertCell(0);
                let c2 = neste_rad.insertCell(1);

                c1.textContent = spiller.navn;
                c2.textContent = JSON.stringify(spiller.hand, null, 2);
                c2.classList.add("spiller-hand");

                document.getElementById("spiller_hand").querySelector("tbody").style.display = "table-row-group";
            }
        }

        // Oppstartsgreier.. Mer smerte :3
        document.addEventListener("DOMContentLoaded", function() {
            const thead = document.getElementById("spiller_hand").querySelector("thead");
            const tbody = document.getElementById("spiller_hand").querySelector("tbody");

            thead.addEventListener("click", function() {
                tbody.style.display = (tbody.style.display === "none" || tbody.style.display === "") ? "table-row-group" : "none";
            });
        });
    </script>
</head>
<body>
    <h1>Bridge tull</h1>
    <p>Dette er ikke ment som frontend elns, bare en mockup for å teste ting uten at jeg må tenke for mye.</br>Oh, right. Memo til meg selv: Håndterer ikke spillere med samme navn.</p>
    <div class="handling_c">
        <input type="text" id="spiller1" value="Jens"><input type="text" id="spiller2" value="Per"><input type="text" id="spiller3" value="Silje"><input type="text" id="spiller4" value="Thomesine">
        <button onclick="start_spill()">Start</button>
        <div id="start_spill_c" class="respons_c">&nbsp;</div>
    </div>
    <div class="handling_c">
        <table id="spiller_hand">
            <thead title="Klikk for å skjule">
                <tr>
                    <th style="width: 150px;">Spiller</th>
                    <th>Hånd</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <div class="handling_c">
        <p>Vi antar mapping Nord, Sør, Øst, Vest. Nord begynner alltid som dealer, og følger klokka. <br>"todo: Tilfeldig tildeling følger senere"</p>
    </div>

</body>
</html>